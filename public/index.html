<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<!--Começo do Material Design Lite-->
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.teal-red.min.css">
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<!--Fim do Material Design Lite-->
<!-- Começo do jquery-->
<script
    src="http://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
<!-- Fim do jquery-->
<script type="text/javascript" src="opengl.js"></script>
<script type="text/javascript">
    const vertexShaderSource = //código fonte do vertex shader
        " precision highp float;\n" +
            "    attribute vec3 vertexPos;\n" +
            "    attribute vec4 vertexColor;\n" +
            "    uniform mat4 modelViewMatrix;\n" +
            "    uniform mat4 projectionMatrix;\n" +
            "    varying vec4 vColor;\n" +
            "    void main(void) {\n" +
            "        vColor = vertexColor;\n" +
            "        gl_Position = projectionMatrix * modelViewMatrix * \n" +
            "            vec4(vertexPos, 1.0);\n" +
            "    }\n";
    const fragmentShaderSource = //código fonte do fragment shader
        " precision highp float;\n" +
            "varying vec4 vColor;\n" +
            "void main(void) {\n" +
            "    // Return the pixel color: always output white\n" +
            "    gl_FragColor = vColor;\n" +
            "}\n";
    //O contexto do opengl
    var gl = undefined;
    //O shader program
    var shaderProgram = undefined;
    //Onde fica meu objeto carregado
    var cubo = undefined;
    //Onde desenho os quadros
    function drawFrame() {
        const t0 = (new Date()).getTime();
        if (!cubo) { //O cubo ainda não existe, só renderiza a tela
            gl.clearColor(Math.random(), Math.random(), Math.random(), 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);
        } else {//O cubo existe
            gl.clearColor(0.1, 0.0, 0.0, 1.0);
            gl.clear(gl.COLOR_BUFFER_BIT);

            // set the shader to use
            gl.useProgram(cubo.shaderProgram);

            gl.bindBuffer(gl.ARRAY_BUFFER, cubo.vertexBufferId);
            gl.vertexAttribPointer(cubo.shaderVertexPositionAttribute, 3, gl.FLOAT, false, 0, 0);

            gl.bindBuffer(gl.ARRAY_BUFFER, cubo.colorBufferId);
            gl.vertexAttribPointer(cubo.shaderVertexColorAttribute, 4, gl.FLOAT, false, 0, 0);

            gl.uniformMatrix4fv(cubo.shaderProjectionMatrixUniform, false, projectionMatrix);
            gl.uniformMatrix4fv(cubo.shaderModelViewMatrixUniform, false, modelViewMatrix);

            gl.drawArrays(gl.TRIANGLES, 0, cubo.numVertices);

        }
        const t = (new Date()).getTime();
        showFPS(t0, t, $("#saida_fps"));
        requestAnimationFrame(drawFrame);
    }

    function requestCube(shaderProgram) {
        var _cubo = {
            "geometry": [
                0.5, 0.5, 0.0, -0.5, 0.5, 0.0, 0.5, -0.5, 0.0, 0.5, -0.5, 0.0, -0.5, 0.5, 0.0, -0.5, -0.5, 0.0
            ],
            "color": [
                0.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0,
                1.0, 1.0, 1.0
            ],
            "numVertices": 6,
            "vertexSize": 3,
            "colorSize": 4,
            "vertexBufferId": -1,
            "colorBufferId": -1
        };
        _cubo.vertexBufferId = gl.createBuffer();//cria o buffer
        gl.bindBuffer(gl.ARRAY_BUFFER, _cubo.vertexBufferId);//passa a trabalhar com ele
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(_cubo.geometry), gl.STATIC_DRAW);//passa o dado

        _cubo.colorBufferId = gl.createBuffer();//cria mais um buffer
        gl.bindBuffer(gl.ARRAY_BUFFER, _cubo.colorBufferId);//passa a trabalhar com o novo buffer
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(_cubo.color), gl.STATIC_DRAW);//passa dados pra ele.
        //Passa o shader pro cubo
        _cubo.shaderProgram = shaderProgram;
        /////Pega os locais das variáveis do shader e guarda no cubo
        _cubo.shaderVertexPositionAttribute = gl.getAttribLocation(shaderProgram, "vertexPos");
        gl.enableVertexAttribArray(_cubo.shaderVertexPositionAttribute);
        _cubo.shaderVertexColorAttribute = gl.getAttribLocation(shaderProgram, "vertexColor");
        gl.enableVertexAttribArray(_cubo.shaderVertexColorAttribute);

        _cubo.shaderProjectionMatrixUniform = gl.getUniformLocation(shaderProgram, "projectionMatrix");
        _cubo.shaderModelViewMatrixUniform = gl.getUniformLocation(shaderProgram, "modelViewMatrix");
        cubo = _cubo;
    }
    //Coisas a fazer no callback da carga
    window.onload = function () {
        let canvas = document.getElementById("webglcanvas");
        //Inicialização do webgl
        gl = initWebGL(canvas); 
        initViewport(gl, canvas.width, canvas.height);
        //Cria as matrizes
        initMatrices();
        //criação do shader program
        shaderProgram = initShader(gl, vertexShaderSource, fragmentShaderSource);
        //Agora crio o cubo
        requestCube();
        requestAnimationFrame(drawFrame);
    }
</script>
<head>
    <meta charset="utf-8"/>
    <title></title>
</head>
<body>
    <div class="content-grid mdl-grid mdl-layout mdl-shadow--2dp ">
        <div class="mdl-shadow--2dp mdl-cell--top mdl-cell--12-col">
            <strong>WebGL - Um exemplo prático</strong>
        </div>
        <div class="mdl-cell mdl-shadow--2dp mdl-cell--6-col">
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp mdl-cell--top">
                <strong>Cena</strong>
            </div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp mdl-cell--stretch">
                <canvas id="webglcanvas" width="400" height="400"></canvas>
            </div>
        </div>
        <div class="mdl-cell mdl-shadow--2dp mdl-cell--6-col">
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp mdl-cell--top">
                <strong>Controles</strong>
            </div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Posição da câmera</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Foco da câmera</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">View Up da câmera</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Tipo de Projeção</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Translação do objeto</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Rotação do objeto</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Pivot do objeto</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Posição da luz</div>
            <div class="mdl-cell mdl-cell--12-col mdl-shadow--2dp">Intensidade da luz</div>
        </div>
        <div class="mdl-shadow--2dp mdl-cell--bottom mdl-cell--12-col">
            <div id="saida_fps" class="mdl-cell mdl-shadow--2dp">FPS: </div>
        </div>
    </div>
</body>

</html>